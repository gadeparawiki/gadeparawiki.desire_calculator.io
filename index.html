<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>ğŸ¦œ Polyglot - Piratical PyScript</title>
      <link rel="stylesheet" href="https://pyscript.net/releases/2024.11.1/core.css">
      <script type="module" src="https://pyscript.net/releases/2024.11.1/core.js"></script>
  </head>
  <body>
    <h1>å¥³ç¥æ¥½åœ’ ç¥ˆé¡˜ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p>100å›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ãŸå¹³å‡å€¤ã‚’å‡ºåŠ›ã—ã¾ã™<br>pythonã‚³ãƒ¼ãƒ‰ã‚’åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹éƒ½åˆä¸Šã€ã‹ãªã‚Šå‡¦ç†æ™‚é–“ãŒé•·ã„ã§ã™<br>é™å®šç¥ˆé¡˜ã¯æœªå®Ÿè£…ã§ã™ï¼ˆå¾Œæ—¥å¯¾å¿œäºˆå®šï¼‰</p>
    <select name="å¿…è¦å¥³ç¥ã®æ€ã„" id="required_desire">
    <option value="">å¿…è¦ãªå¥³ç¥ã®æ€ã„</option>
    <option>60</option>
    <option>100</option>
    <option>150</option>
    <option>160</option>
    <option>240</option>
    <option>60, 100</option>
    <option>100, 100</option>
    <option>150, 100</option>
    <option>60, 100, 100</option>
    </select>
    <button py-click="calc_pray_count">Calculate</button>
    <div id="output"></div>
    <script type="py" src="./main.py" config="./pyscript.json"></script>
    <hr />
    <pre><code>
    ä½¿ç”¨ã—ã¦ã„ã‚‹pythonã‚³ãƒ¼ãƒ‰

    '''
      import numpy as np
      import re
      from pyscript import document
      
      # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›æ•°
      iteration = 100
      
      # ç¥ˆé¡˜1å›ã‚ãŸã‚Šã®ç²å¾—ã‚¢ã‚¤ãƒ†ãƒ ã¨ç¢ºç‡
      items = ['book1', 'stone', 'gold', 'book2', 'grace', 'desire', 'ticket']
      probability = [0.24, 0.14, 0.14, 0.23, 0.08, 0.11, 0.06]
      
      # 9%ã§2å€ã€2%ã§5å€ã¨ä»®å®š
      magnification = [1, 2, 5]
      magnification_probability = [0.89, 0.09, 0.02]
      
      # ãƒ©ãƒ³ãƒ€ãƒ ã§å€ç‡ã‚’è¿”ã™é–¢æ•°
      def choice_magnification():
        return np.random.choice(magnification, 1, p=magnification_probability)[0]
      
      # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
      def calc_pray_count(event):
        # htmlã‹ã‚‰ã®å…¥åŠ›å‡¦ç†
        # ç›®æ¨™ã®å¥³ç¥ã®æ€ã„ã®å€‹æ•°(URã¨UTRãªã©ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹å ´åˆã¯åˆ†ã‘ã¦æŒ‡å®šã€‚ä¾‹ï¼š[150, 100])
        input_text = document.querySelector("#required_desire")
        target_desire_list = [int(d) for d in re.split('[, ]', input_text.value) if d != '']
        print(target_desire_list)
      
        # ç¥ˆé¡˜ã‚«ã‚¦ãƒ³ã‚¿
        count = 0
        # å¥³ç¥ã®æ€ã„ã‚«ã‚¦ãƒ³ã‚¿
        desire_count = 0
      
        # ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
        for _ in range(iteration):
          for target_desire in target_desire_list:
            while desire_count < target_desire:
              count+=1
              if count % 10 == 0:
                desire_count += 5 * choice_magnification()
              elif np.random.choice(items, 1, p=probability)[0] == 'desire':
                desire_count += 2 * choice_magnification()
            desire_count -= target_desire
      
        # çµæœå‡ºåŠ›
        print(f'{count/iteration}å›')
        output_div = document.querySelector("#output")
        output_div.innerText = f'å®Ÿè¡Œçµæœï¼š{count/iteration}å›'
    '''
    </code></pre>
  </body>
</html>
